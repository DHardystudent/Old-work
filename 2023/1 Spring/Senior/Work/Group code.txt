<template>
  <v-container class="fill-height">
    <v-responsive class="d-flex text-center fill-height">
      <v-row class="panel d-flex align-center">
        <v-col>
          <v-card class="align-center justify-center" title="Manage Groups">

            <v-card-actions class="align-center justify-center">
            <!-- Create group pop up box (holds nothing so far)-->
              <v-dialog v-model="dialog" width="1024">
                <template v-slot:activator="{ props }">
                  <v-btn color="primary" v-bind="props">
                    Create Group
                  </v-btn>
                </template>
                <v-card>
                  <v-card-title>
                    <span class="text-h5">Create Group</span>
                  </v-card-title>
                  <v-card-text>
                    <v-container>
                      <v-row>
                        <v-col>
                          <v-text-field label="Group Name*" required></v-text-field>
                        </v-col>
                      </v-row>
                      Under Construction
                    </v-container>
                  </v-card-text>
                  <v-card-actions>
                    <v-btn color="red-darken-4" variant="text" @click="dialog=false">
                      Close
                    </v-btn>
                    <v-btn color="blue-darken-1" variant="text" @click="dialog=false">
                      Save
                    </v-btn>
                  </v-card-actions>
                </v-card>
              </v-dialog>
              <!-- Remove group needs to be worked on-->
              <v-dialog v-model="dialog" width="1024">
                <template v-slot:activator="{ props }">
                  <v-btn color="primary" v-bind="props">
                    Remove Group
                  </v-btn>
                </template>
                <v-card>
                  <v-card-title>
                    <span class="text-h5">Remove Group</span>
                  </v-card-title>
                  <v-card-text>
                    <v-container>
                      <v-row>
                        <v-col>
                          <v-text-field label="Group Name*" required></v-text-field>
                        </v-col>
                      </v-row>
                      Under Construction
                    </v-container>
                  </v-card-text>
                  <v-card-actions>
                    <v-btn color="red-darken-4" variant="text" @click="dialog=false">
                      Close
                    </v-btn>
                    <v-btn color="blue-darken-1" variant="text" @click="dialog=false">
                      Save
                    </v-btn>
                  </v-card-actions>
                </v-card>
              </v-dialog>
              <!-- Edit group work in progress-->
              <v-dialog v-model="dialog" width="1024">
                <template v-slot:activator="{ props }">
                  <v-btn color="primary" v-bind="props">
                    Edit Group
                  </v-btn>
                </template>
                <v-card>
                  <v-card-title>
                    <span class="text-h5">Edit Group</span>
                  </v-card-title>
                  <v-card-text>
                    <v-container>
                      <v-row>
                        <v-col>
                          <v-text-field label="Group Name*" required></v-text-field>
                        </v-col>
                      </v-row>
                      Under Construction
                    </v-container>
                  </v-card-text>
                  <v-card-actions>
                    <v-btn color="red-darken-4" variant="text" @click="dialog=false">
                      Close
                    </v-btn>
                    <v-btn color="blue-darken-1" variant="text" @click="dialog=false">
                      Save
                    </v-btn>
                  </v-card-actions>
                </v-card>
              </v-dialog>
            </v-card-actions>
            <v-table>
              <thead>
                <tr>
                  <th class="text-center">
                    Group ID
                  </th>
                  <th class="text-center">
                    Group Name
                  </th>
                </tr>
              </thead>
              <tbody v-if="groupsList !== null">
                
                  <tr v-for="(group, i) in groupList" :key="i">
                    <th>
                      <v-checkbox :value="groupItem.id" @change="handleSelect"></v-checkbox>
                    </th>
                    <td><a :href="`/groups/${groupItem.id}`">{{  groupItem.name }}
                    </a>
                    </td>
                  </tr>
                    
              </tbody>
            </v-table>

            Still Under Construction:
          </v-card>
        </v-col>
      </v-row>
    </v-responsive>
  </v-container>
</template>
<!-- Functions to place data into backend-->
<script>
import api from '@/services/api/';

export default {
  name: 'Groups',
  data: function () {
    return {
      new_group: false,
      edit_group: false,
      delete_group: false,
      new_group_data: null,
      edit_group_data: null,
      delete_group_data: null,
      groups: null,
    }
  },
  mounted: function () {
    this.get_groups()
  },
  methods: {
    get_groups: function () {
      api.get('/groups/').then(res=> {
        this.groups = res.data.results
        console.log(res)
      }).catch(err => {
        console.error(err)
        this.$store.dispatch('showNotification', {
          color: 'red',
          message: 'Error retrieving groups.',
        });
      })
    },
    new_group: function() {
      this.new_group_data = {name: ''}
      this.new_group = true
    },
    create_group: function () {
      api.post('/group/', this.new_group_data).then(res => {
        this.$store.dispatch('showNotification', {
          color: 'green',
          message: 'Created certification succesfully.',
        });
      }).finally(() => {
        this.new_group = false
        this.new_group_data = null
        this.get_groups()
      });
    },
    cancel_new: function () {
      this.new_group = false
      this.new_group_data = null
    },

    edit_group: function (group) {
      this.edit_group_data = JSON.parse(JSON.stringify(cert))
      this.edit_group = true
    },
    modify_group: function () {
      api.put('/groups/${this.edit_group_data.id}/',
      this.edit_group_data).then(res => {
        this.$store.dispatch('showNotification', {
          color: 'green',
          message: 'Updated group successfully.',
        });
      }).catch(err => {
        console.error(err)
        this.$store.dispatch('showNotification', {
          color: 'red',
          message: 'Error updating group.',
        });
      }).finally(() => {
          this.edit_group_data = null
          this.edit_group = false
          this.get_groups()
        });
      },
      cancel_edit: function () {
        this.edit_group_data = null
        this.edit_group = false
      },
      remove_group: function () {
        api.delete('/groups/${this.delete_group_data.id}').then(res => {
          this.$store.dispatch('showNotification', {
            color: 'green',
            message: 'Group successfully removed.',
          });
        }).finally(() => {
          this.delete_group_data = null
          this.delete_group = false
          this.get_groups()
        });
      },
      cancel_delete: function () {
        this.delete_group_data = null
        this.delete_group = false
      },
    }
  }

}
</script>


<!-- Scoped styles for ManageGroups.vue-->
<style scoped>
.admin-actions {
  margin-left: 3em;
  margin-right: 3em;
}
</style>